**Escape Analysis ржХрзА? (Java / JVM)**
рж╕рж╣ржЬ ржнрж╛рж╖рж╛рзЯ, ржЗржирзНржЯрж╛рж░ржнрж┐ржЙ-рж░рзЗржбрж┐ ржмрзНржпрж╛ржЦрзНржпрж╛ ЁЯСЗ

---

## ЁЯФ╣ Escape Analysis ржХрзА?

**Escape Analysis** рж╣рж▓рзЛ **JVM (HotSpot)-ржПрж░ ржПржХржЯрж┐ optimization technique** ржпрж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзЗтАФ

> **ржХрзЛржирзЛ object рждрж╛рж░ рждрзИрж░рж┐ рж╣ржУрзЯрж╛ method ржмрж╛ thread-ржПрж░ ржмрж╛ржЗрж░рзЗ тАЬescapeтАЭ ржХрж░ржЫрзЗ ржХрж┐ ржирж╛ред**

ржпржжрж┐ object **escape ржирж╛ ржХрж░рзЗ**, JVM рж╕рзЗржЗ object-ржХрзЗ **heap-ржП ржирж╛ рж░рзЗржЦрзЗ** ржЖрж░ржУ ржжрзНрж░рзБрждржнрж╛ржмрзЗ **stack-ржП allocate** ржХрж░рждрзЗ ржкрж╛рж░рзЗ ржмрж╛ **ржкрзБрж░рзЛржкрзБрж░рж┐ eliminate** ржХрж░рждрзЗ ржкрж╛рж░рзЗред

---

## ЁЯФ╣ тАЬEscapeтАЭ ржорж╛ржирзЗ ржХрзА?

ржПржХржЯрж╛ object ржпржжрж┐тАФ

* method ржерзЗржХрзЗ **return** рж╣рзЯ
* ржЕржирзНржп method-ржП **pass** рж╣рзЯ
* ржХрзЛржирзЛ **field/static variable**-ржП assign рж╣рзЯ
* **ржЕржирзНржп thread**-ржП share рж╣рзЯ

ЁЯСЙ рждрж╛рж╣рж▓рзЗ object **escape ржХрж░рзЗ**ред

---

## ЁЯФ╣ Escape Analysis ржХрзЗржи ржжрж░ржХрж╛рж░?

ржХрж╛рж░ржг:

* Heap allocation ржзрзАрж░
* GC (Garbage Collection) costly
* Stack allocation ржжрзНрж░рзБржд ржПржмржВ GC рж▓рж╛ржЧрзЗ ржирж╛

ЁЯСЙ Escape Analysis **performance ржмрж╛рзЬрж╛рзЯ**ред

---

## ЁЯФ╣ ржЙржжрж╛рж╣рж░ржг (Escape ржХрж░рзЗ ржирж╛)

```java
public void test() {
    Object o = new Object();
}
```

### ржХрзА ржШржЯрзЗ?

* `o` method-ржПрж░ ржмрж╛ржЗрж░рзЗ ржпрж╛рзЯ ржирж╛
* JVM ржмрзБржЭрзЗ ржирзЗрзЯ: **no escape**
* рждрж╛ржЗ JVM ржкрж╛рж░рзЗ:

  * Stack-ржП allocate ржХрж░рждрзЗ
  * ржЕржержмрж╛ object-ржЯрж╛ржЗ remove ржХрж░рждрзЗ (scalar replacement)

---

## ЁЯФ╣ ржЙржжрж╛рж╣рж░ржг (Escape ржХрж░рзЗ)

### 1я╕ПтГг Return ржХрж░рж▓рзЗ

```java
public Object test() {
    Object o = new Object();
    return o;
}
```

ЁЯСЙ method-ржПрж░ ржмрж╛ржЗрж░рзЗ ржЧрзЗрж▓ тЖТ **escape**

---

### 2я╕ПтГг Field-ржП assign ржХрж░рж▓рзЗ

```java
Object field;

public void test() {
    field = new Object();
}
```

ЁЯСЙ object ржЕржирзНржп ржЬрж╛рзЯржЧрж╛ ржерзЗржХрзЗ accessible тЖТ **escape**

---

### 3я╕ПтГг Method-ржП pass ржХрж░рж▓рзЗ

```java
public void test() {
    Object o = new Object();
    use(o);
}
```

ЁЯСЙ JVM ржирж┐рж╢рзНржЪрж┐ржд рж╣рждрзЗ ржкрж╛рж░рзЗ ржирж╛ тЖТ **escape**

---

## ЁЯФ╣ Escape Analysis рж╣рж▓рзЗ JVM ржХрзА ржХрзА optimization ржХрж░рзЗ?

### тЬЕ 1. Stack Allocation

```java
Object o = new Object();
```

* Heap ржирзЯ
* Stack-ржП allocate
* Method рж╢рзЗрж╖ тЖТ automatically destroy

---

### тЬЕ 2. Scalar Replacement

```java
class Point {
    int x, y;
}
```

JVM object ржмрж╛ржирж╛рзЯ ржирж╛, ржмрж░ржВ:

```java
int x, y;   // fields ржЖрж▓рж╛ржжрж╛ ржХрж░рзЗ рж░рж╛ржЦрзЗ
```

ЁЯСЙ **Object completely disappears!**

---

### тЭМ 3. Heap Allocation (fallback)

ржпржжрж┐ JVM prove ржХрж░рждрзЗ ржирж╛ ржкрж╛рж░рзЗ тЖТ heap-ржП рж░рж╛ржЦрзЗред

---

## ЁЯФ╣ Escape Analysis ржПрж░ ржзрж░ржи

| Type          | ржорж╛ржирзЗ                  |
| ------------- | --------------------- |
| No Escape     | Method-ржПрж░ ржоржзрзНржпрзЗржЗ ржерж╛ржХрзЗ |
| Method Escape | Method-ржПрж░ ржмрж╛ржЗрж░рзЗ ржпрж╛рзЯ   |
| Thread Escape | ржЕржирзНржп thread-ржП ржпрж╛рзЯ     |

---

## ЁЯФ╣ JVM Flag (ржЗржирзНржЯрж╛рж░ржнрж┐ржЙ ржмрзЛржирж╛рж╕)

```bash
-XX:+DoEscapeAnalysis
```

HotSpot JVM-ржП ржПржЯрж┐ **default ON** (Java 8+)

---

## ЁЯФ╣ Important Truth (ржЗржирзНржЯрж╛рж░ржнрж┐ржЙрждрзЗ ржмрж▓рж╛ ржЙржЪрж┐ржд)

> Java Language Specification ржХржЦржирзЛ ржмрж▓рзЗ ржирж╛ object stack-ржП ржерж╛ржХржмрзЗред
> ржПржЯрж┐ рж╕ржорзНржкрзВрж░рзНржг **JVM optimization**, guarantee ржирзЯред

---

## ЁЯза ржПржХ рж▓рж╛ржЗржирзЗрж░ ржЗржирзНржЯрж╛рж░ржнрж┐ржЙ ржЙрждрзНрждрж░

> **тАЬEscape Analysis рж╣рж▓рзЛ JVM optimization ржпрж╛ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рзЗ ржХрзЛржирзЛ object method ржмрж╛ thread-ржПрж░ ржмрж╛ржЗрж░рзЗ escape ржХрж░ржЫрзЗ ржХрж┐ ржирж╛, ржПржмржВ ржирж╛ ржХрж░рж▓рзЗ heap allocation ржПрзЬрж┐рзЯрзЗ stack allocation ржмрж╛ scalar replacement ржХрж░рзЗредтАЭ**

---

ржЪрж╛ржУ рждрзЛ ржЖржорж┐ ржкрж░рзЗрж░ржЯрж╛ ржмрзБржЭрж┐рзЯрзЗ ржжрж┐рждрзЗ ржкрж╛рж░рж┐:

* ЁЯФе Escape Analysis MCQs
* тЪая╕П Real production pitfalls
* ЁЯзк JIT + GC interaction
* ЁЯЪА Performance tuning examples
